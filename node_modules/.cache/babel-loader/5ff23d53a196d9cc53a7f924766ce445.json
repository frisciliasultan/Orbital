{"ast":null,"code":"import axios from 'axios';\nimport { SET_BOARD_FILLED, SET_MODULES, SET_RULES, SET_CALL_BACKEND_NOW, SET_SELECTED_MODULES, SET_MODULE_LOCATION, SET_CURRRENT_SEMESTER, SET_MODPLAN_LOADING, CLEAN_UP_MODPLAN } from './types';\nimport setAuthToken from '../utils/setAuthToken';\n\nconst compile = require('../backend_utils/compile');\n\nconst toView = require('../backend_utils/toView');\n\nexport const setIsBoardFilled = () => {\n  return {\n    type: SET_BOARD_FILLED\n  };\n};\nexport const callBackendAPI = (backend, modplanObj, history) => async dispatch => {\n  if (backend === 'NUSMods') {\n    setAuthToken(false);\n    axios.get('https://api.nusmods.com/v2/2018-2019/moduleInfo.json').then(res => dispatch(setModules(res.data))).then(setAuthToken(localStorage.jwtToken)).catch(err => {\n      console.log(err);\n    });\n  } else {\n    dispatch(setModPlanLoading(true));\n    const modplan = modplanObj.map(obj => {\n      return obj.moduleCode;\n    });\n\n    try {\n      const ruleList = await axios.get('https://modtree-api.netlify.app/.netlify/functions/user/directory');\n      const ruleData = await Promise.all(ruleList.data.list.map(ruleTag => {\n        return axios.get('https://modtree-api.netlify.app/.netlify/functions/rules/assemble/' + ruleTag).then(res => {\n          if (res.status !== 200) {\n            throw Error(res.message);\n          }\n\n          return res.data;\n        }).then(res => {\n          return compile(res);\n        });\n      }));\n      const evaluatedRules = await evalRules(ruleData, modplan);\n      dispatch(setRules(evaluatedRules));\n      dispatch(setModPlanLoading(false));\n      return ruleData;\n    } catch (err) {\n      dispatch(setModPlanLoading(false));\n      console.log(err);\n      history.push(\"./500-error\");\n    }\n\n    ;\n  }\n};\nexport const evalRules = (ruleData, modplan) => {\n  return Promise.all(ruleData.map(asyncFunc => {\n    return asyncFunc({\n      modules: modplan\n    }).then(res => toView(res));\n  }));\n};\nexport const setModules = modules => {\n  return {\n    type: SET_MODULES,\n    payload: modules\n  };\n};\nexport const setRules = rules => {\n  return {\n    type: SET_RULES,\n    payload: rules\n  };\n};\nexport const setCallBackendNow = status => {\n  return {\n    type: SET_CALL_BACKEND_NOW,\n    payload: status\n  };\n};\nexport const setSelectedModules = (object, selectedModules) => {\n  return {\n    type: SET_SELECTED_MODULES,\n    moduleAdded: object,\n    currentSelectedModules: selectedModules\n  };\n};\nexport const setModuleLocation = (item, location, AY, selectedModules) => {\n  return {\n    type: SET_MODULE_LOCATION,\n    item,\n    location,\n    AY,\n    modules: selectedModules\n  };\n};\nexport const setCurrentSemester = (AY, semester) => {\n  return {\n    type: SET_CURRRENT_SEMESTER,\n    AY,\n    semester\n  };\n};\nexport const setModPlanLoading = status => {\n  return {\n    type: SET_MODPLAN_LOADING,\n    status\n  };\n};\nexport const cleanUpModPlan = () => {\n  return {\n    type: CLEAN_UP_MODPLAN\n  };\n};","map":{"version":3,"sources":["/Users/frisciliasultan/Documents/Orbitalhosting/src/actions/modplanActions.js"],"names":["axios","SET_BOARD_FILLED","SET_MODULES","SET_RULES","SET_CALL_BACKEND_NOW","SET_SELECTED_MODULES","SET_MODULE_LOCATION","SET_CURRRENT_SEMESTER","SET_MODPLAN_LOADING","CLEAN_UP_MODPLAN","setAuthToken","compile","require","toView","setIsBoardFilled","type","callBackendAPI","backend","modplanObj","history","dispatch","get","then","res","setModules","data","localStorage","jwtToken","catch","err","console","log","setModPlanLoading","modplan","map","obj","moduleCode","ruleList","ruleData","Promise","all","list","ruleTag","status","Error","message","evaluatedRules","evalRules","setRules","push","asyncFunc","modules","payload","rules","setCallBackendNow","setSelectedModules","object","selectedModules","moduleAdded","currentSelectedModules","setModuleLocation","item","location","AY","setCurrentSemester","semester","cleanUpModPlan"],"mappings":"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","sourcesContent":["import axios from 'axios';\nimport {\n    SET_BOARD_FILLED,\n    SET_MODULES,\n    SET_RULES,\n    SET_CALL_BACKEND_NOW,\n    SET_SELECTED_MODULES,\n    SET_MODULE_LOCATION,\n    SET_CURRRENT_SEMESTER,\n    SET_MODPLAN_LOADING,\n    CLEAN_UP_MODPLAN\n} from './types';\nimport setAuthToken from '../utils/setAuthToken';\n\nconst compile = require('../backend_utils/compile');\nconst toView = require('../backend_utils/toView');\n\nexport const setIsBoardFilled = () => {\n    return {\n        type: SET_BOARD_FILLED,\n    }\n}\n\nexport const callBackendAPI = (backend, modplanObj, history) => async dispatch => {\n\n    if(backend === 'NUSMods') {\n        setAuthToken(false);\n        axios.get('https://api.nusmods.com/v2/2018-2019/moduleInfo.json' )\n        .then(res => dispatch(setModules(res.data)))\n        .then(setAuthToken(localStorage.jwtToken))\n        .catch(err => {\n            console.log(err)\n        });\n        \n    } else {\n        dispatch(setModPlanLoading(true));\n        const modplan = modplanObj.map((obj) => {\n            return obj.moduleCode\n        });\n        try {\n            const ruleList = await axios.get('https://modtree-api.netlify.app/.netlify/functions/user/directory');\n            const ruleData = await Promise.all(ruleList.data.list.map((ruleTag) => {\n                return axios\n                    .get('https://modtree-api.netlify.app/.netlify/functions/rules/assemble/' + ruleTag)\n                    .then(res => {\n                        if(res.status !== 200) {\n                            throw Error (res.message);\n                        }\n                        return res.data    \n                    })\n                    .then(res => {\n                        return compile(res);\n                    })\n\n            }));\n            const evaluatedRules = await evalRules(ruleData, modplan);\n            dispatch(setRules(evaluatedRules));\n            dispatch(setModPlanLoading(false));\n            return ruleData;\n        } catch(err) {\n            dispatch(setModPlanLoading(false));\n            console.log(err);\n            history.push(\"./500-error\")\n        };\n    }\n    \n}\n\nexport const evalRules = (ruleData, modplan) => {\n    return Promise.all(ruleData.map((asyncFunc) => {\n        return asyncFunc({modules: modplan})\n            .then(res => toView(res))\n    }));\n}\n\nexport const setModules = (modules) => {\n    return {\n        type: SET_MODULES,\n        payload: modules\n    }\n}\n\nexport const setRules = (rules) => {\n    return {\n        type: SET_RULES,\n        payload: rules\n    }\n}\n\nexport const setCallBackendNow = (status) => {\n    return {\n        type: SET_CALL_BACKEND_NOW,\n        payload: status\n    }\n}\n\nexport const setSelectedModules = (object, selectedModules) => {\n    return { \n        type: SET_SELECTED_MODULES,\n        moduleAdded: object,\n        currentSelectedModules: selectedModules\n    }\n}\n\nexport const setModuleLocation = (item, location, AY, selectedModules) => {\n    return { \n        type: SET_MODULE_LOCATION,\n        item,\n        location,\n        AY,\n        modules: selectedModules\n    }\n}\n\nexport const setCurrentSemester = (AY, semester) => {\n    return {\n        type: SET_CURRRENT_SEMESTER,\n        AY,\n        semester\n    }\n}\n\nexport const setModPlanLoading = (status) => {\n    return {\n        type: SET_MODPLAN_LOADING,\n        status\n    }\n}\nexport const cleanUpModPlan = () => {\n    return { \n        type: CLEAN_UP_MODPLAN\n    }\n}"]},"metadata":{},"sourceType":"module"}